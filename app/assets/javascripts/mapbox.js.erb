// map.scrollWheelZoom.disable();

function addVenues (map, geojson)  {
  var addLayer = L.mapbox.featureLayer(geojson).addTo(map);
  // showMyLocation(map, myLayer);
}

function addMapSearchTool (map) {
  map.addControl(L.mapbox.geocoderControl('mapbox.places'));
}

function searchNearMe (map) {
  $("#retrieveLocation").on('click', function (event) {
    event.preventDefault();
    var coords = $("#push_location").val();
    var URL = "/near_me?coords=" + coords + "";
    $.ajax({
      url: URL,
      success: handleSuccess,
      error: handleError
      });
   });

  function handleSuccess (data) {
    $(".sidebar .row").empty();
    var newLayer = L.mapbox.featureLayer(data).addTo(map);
    renderSidebar(data);
    sidebarNavigator(map);
  }

  function handleError(jqXHR, status, errorThrown) {
  alert("Something wrong happened: " + status + ", " + errorThrown);
  };
}

function renderSidebar (data) {
  data.forEach(function (venue) {
        var contents = $(".sidebar .row").prepend(
          "<div class='thumbnail venue'><img src='" + venue.properties.image_url + 
          "'><div class='caption'><h3 data-lat='" + venue.geometry.coordinates[1] + 
          "' data-lng= '"+ venue.geometry.coordinates[0] + "'>" + venue.properties.title +
          "</h3><p>" + venue.properties.description + "</p><p> Rating: " + venue.properties.rating +
          "</p><p>" + "</p><p> Category: " + venue.properties.category + "</p><p>" +
          "<button class='btn btn-primary' type='submit'> Save </button>" +
          "<a href='#' class='btn btn-default' role='button'> Button </a></p></div></div>"
          );
      });
}

function sidebarNavigator (map) {
  $(".venue").on('click', 'h3', function () {
    var self = this;
    map.setView([self.dataset.lat,self.dataset.lng], 14)
  });
}

function findMyLocation (map) {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(onLocation, onError);
    console.log("Location Found!");
  }

  function onLocation (position) {
  $("#push_location").val([position.coords.latitude, position.coords.longitude]);
  }

  function onError (err) {
  alert("Could not locate your current position, " + err)
  }
}

// function addMyMarker (map) {
//   var coords = $("#push_location").val()
//   debugger
//   var marker = L.marker(new L.LatLng(parseInt(coords[0]),parseInt(coords[1])), {
//        icon: L.mapbox.marker.icon({
//            'marker-symbol': 'star',
//            'marker-size': 'large',
//            'marker-color': '#ff8888'
//        }),
//    });
// }


//my previous work
// function showMyLocation (map, layer) {
//   map.on('locationfound', function(e) {
//       map.fitBounds(e.bounds);

//       layer.setGeoJSON({
//           type: 'Feature',
//           geometry: {
//               type: 'Point',
//               coordinates: [e.latlng.lng, e.latlng.lat]
//           },
//           properties: {
//               'title': 'Current location!',
//               'marker-color': '#ff8888',
//               "marker-size": "large",
//               'marker-symbol': 'star'
//           }
//       });
//   });

//   map.on('locationerror', function() {
//     alert('Position could not be found');
//   });

// }
